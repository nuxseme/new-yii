(function(h){h.fn.yiiActiveForm=function(r){if(c[r]){return c[r].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof r==="object"||!r){return c.init.apply(this,arguments)}else{h.error("Method "+r+" does not exist on jQuery.yiiActiveForm");return false}}};var p={beforeValidate:"beforeValidate",afterValidate:"afterValidate",beforeValidateAttribute:"beforeValidateAttribute",afterValidateAttribute:"afterValidateAttribute",beforeSubmit:"beforeSubmit",ajaxBeforeSend:"ajaxBeforeSend",ajaxComplete:"ajaxComplete"};var f={encodeErrorSummary:true,errorSummary:".error-summary",validateOnSubmit:true,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:undefined,scrollToError:true};var d={id:undefined,name:undefined,container:undefined,input:undefined,error:".help-block",encodeError:true,validateOnChange:true,validateOnBlur:true,validateOnType:false,validationDelay:500,enableAjaxValidation:false,validate:undefined,status:0,cancelled:false,value:undefined};var e;var q=function(r){e=h.Deferred();r.data("yiiSubmitFinalizePromise",e.promise())};var n=function(r){if(e){e.resolve();e=undefined;r.removeData("yiiSubmitFinalizePromise")}};var c={init:function(r,s){return this.each(function(){var t=h(this);if(t.data("yiiActiveForm")){return}var u=h.extend({},f,s||{});if(u.validationUrl===undefined){u.validationUrl=t.attr("action")}h.each(r,function(v){r[v]=h.extend({value:g(t,this)},d,this);i(t,r[v])});t.data("yiiActiveForm",{settings:u,attributes:r,submitting:false,validated:false});t.bind("reset.yiiActiveForm",c.resetForm);if(u.validateOnSubmit){t.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",function(){t.data("yiiActiveForm").submitObject=h(this)});t.on("submit.yiiActiveForm",c.submitForm)}})},add:function(s){var r=h(this);s=h.extend({value:g(r,s)},d,s);r.data("yiiActiveForm").attributes.push(s);i(r,s)},remove:function(v){var s=h(this),r=s.data("yiiActiveForm").attributes,t=-1,u=undefined;h.each(r,function(w){if(r[w]["id"]==v){t=w;u=r[w];return false}});if(t>=0){r.splice(t,1);k(s,u)}return u},validateAttribute:function(s){var r=c.find.call(this,s);if(r!=undefined){l(h(this),r,true)}},find:function(t){var s=h(this).data("yiiActiveForm").attributes,r=undefined;h.each(s,function(u){if(s[u]["id"]==t){r=s[u];return false}});return r},destroy:function(){return this.each(function(){h(this).unbind(".yiiActiveForm");h(this).removeData("yiiActiveForm")})},data:function(){return this.data("yiiActiveForm")},validate:function(){var s=h(this),x=s.data("yiiActiveForm"),r=false,v={},u=a(),w=x.submitting;if(w){var t=h.Event(p.beforeValidate);s.trigger(t,[v,u]);if(t.result===false){x.submitting=false;n(s);return}}h.each(x.attributes,function(){this.cancelled=false;if(x.submitting||this.status===2||this.status===3){var z=v[this.id];if(z===undefined){z=[];v[this.id]=z}var y=h.Event(p.beforeValidateAttribute);s.trigger(y,[this,z,u]);if(y.result!==false){if(this.validate){this.validate(this,g(s,this),z,u,s)}if(this.enableAjaxValidation){r=true}}else{this.cancelled=true}}});h.when.apply(this,u).always(function(){for(var y in v){if(0===v[y].length){delete v[y]}}if(r){var z=x.submitObject,A="&"+x.settings.ajaxParam+"="+s.attr("id");if(z&&z.length&&z.attr("name")){A+="&"+z.attr("name")+"="+z.attr("value")}h.ajax({url:x.settings.validationUrl,type:s.attr("method"),data:s.serialize()+A,dataType:x.settings.ajaxDataType,complete:function(B,C){s.trigger(p.ajaxComplete,[B,C])},beforeSend:function(C,B){s.trigger(p.ajaxBeforeSend,[C,B])},success:function(B){if(B!==null&&typeof B==="object"){h.each(x.attributes,function(){if(!this.enableAjaxValidation||this.cancelled){delete B[this.id]}});o(s,h.extend(v,B),w)}else{o(s,v,w)}},error:function(){x.submitting=false;n(s)}})}else{if(x.submitting){setTimeout(function(){o(s,v,w)},200)}else{o(s,v,w)}}})},submitForm:function(){var r=h(this),t=r.data("yiiActiveForm");if(t.validated){t.submitting=false;var s=h.Event(p.beforeSubmit);r.trigger(s);if(s.result===false){t.validated=false;n(r);return false}return true}else{q(r);if(t.settings.timer!==undefined){clearTimeout(t.settings.timer)}t.submitting=true;c.validate.call(r);return false}},resetForm:function(){var r=h(this);var s=r.data("yiiActiveForm");setTimeout(function(){h.each(s.attributes,function(){this.value=g(r,this);this.status=0;var t=r.find(this.container);t.removeClass(s.settings.validatingCssClass+" "+s.settings.errorCssClass+" "+s.settings.successCssClass);t.find(this.error).html("")});r.find(s.settings.errorSummary).hide().find("ul").html("")},1)},updateMessages:function(t,s){var r=h(this);var u=r.data("yiiActiveForm");h.each(u.attributes,function(){j(r,this,t)});if(s){m(r,t)}},updateAttribute:function(u,s){var r=c.find.call(this,u);if(r!=undefined){var t={};t[u]=s;j(h(this),r,t)}}};var i=function(r,s){var t=b(r,s);if(s.validateOnChange){t.on("change.yiiActiveForm",function(){l(r,s,false)})}if(s.validateOnBlur){t.on("blur.yiiActiveForm",function(){if(s.status==0||s.status==1){l(r,s,!s.status)}})}if(s.validateOnType){t.on("keyup.yiiActiveForm",function(u){if(h.inArray(u.which,[16,17,18,37,38,39,40])!==-1){return}if(s.value!==g(r,s)){l(r,s,false,s.validationDelay)}})}};var k=function(r,s){b(r,s).off(".yiiActiveForm")};var l=function(r,t,s,v){var u=r.data("yiiActiveForm");if(s){t.status=2}h.each(u.attributes,function(){if(this.value!==g(r,this)){this.status=2;s=true}});if(!s){return}if(u.settings.timer!==undefined){clearTimeout(u.settings.timer)}u.settings.timer=setTimeout(function(){if(u.submitting||r.is(":hidden")){return}h.each(u.attributes,function(){if(this.status===2){this.status=3;r.find(this.container).addClass(u.settings.validatingCssClass)}});c.validate.call(r)},v?v:200)};var a=function(){var r=[];r.add=function(s){this.push(new h.Deferred(s))};return r};var o=function(z,t,v){var u=z.data("yiiActiveForm");if(v){var s=[];h.each(u.attributes,function(){if(!this.cancelled&&j(z,this,t)){s.push(this)}});z.trigger(p.afterValidate,[t,s]);m(z,t);if(s.length){if(u.settings.scrollToError){var x=z.find(h.map(s,function(A){return A.input}).join(",")).first().closest(":visible").offset().top;var w=h(window).scrollTop();if(x<w||x>w+h(window).height()){h(window).scrollTop(x)}}u.submitting=false}else{u.validated=true;var r=u.submitObject||z.find(":submit:first");if(r.length&&r.attr("type")=="submit"&&r.attr("name")){var y=h('input[type="hidden"][name="'+r.attr("name")+'"]',z);if(!y.length){h("<input>").attr({type:"hidden",name:r.attr("name"),value:r.attr("value")}).appendTo(z)}else{y.attr("value",r.attr("value"))}}z.submit()}}else{h.each(u.attributes,function(){if(!this.cancelled&&(this.status===2||this.status===3)){j(z,this,t)}})}n(z)};var j=function(t,v,u){var w=t.data("yiiActiveForm"),y=b(t,v),s=false;if(!h.isArray(u[v.id])){u[v.id]=[]}t.trigger(p.afterValidateAttribute,[v,u[v.id]]);v.status=1;if(y.length){s=u[v.id].length>0;var x=t.find(v.container);var r=x.find(v.error);if(s){if(v.encodeError){r.text(u[v.id][0])}else{r.html(u[v.id][0])}x.removeClass(w.settings.validatingCssClass+" "+w.settings.successCssClass).addClass(w.settings.errorCssClass)}else{r.empty();x.removeClass(w.settings.validatingCssClass+" "+w.settings.errorCssClass+" ").addClass(w.settings.successCssClass)}v.value=g(t,v)}return s};var m=function(s,u){var v=s.data("yiiActiveForm"),r=s.find(v.settings.errorSummary),t=r.find("ul").empty();if(r.length&&u){h.each(v.attributes,function(){if(h.isArray(u[this.id])&&u[this.id].length){var w=h("<li/>");if(v.settings.encodeErrorSummary){w.text(u[this.id][0])}else{w.html(u[this.id][0])}t.append(w)}});r.toggle(t.find("li").length>0)}};var g=function(s,u){var v=b(s,u);var t=v.attr("type");if(t==="checkbox"||t==="radio"){var r=v.filter(":checked");if(!r.length){r=s.find('input[type=hidden][name="'+v.attr("name")+'"]')}return r.val()}else{return v.val()}};var b=function(r,s){var t=r.find(s.input);if(t.length&&t[0].tagName.toLowerCase()==="div"){return t.find("input")}else{return t}}})(window.jQuery);