(function(l){var a,g;a=l.Bloodhound;g={data:"data",protocol:"protocol",thumbprint:"thumbprint"};l.Bloodhound=c;function c(t){if(!t||(!t.local&&!t.prefetch&&!t.remote)){$.error("one of local, prefetch, or remote is required")}this.limit=t.limit||5;this.sorter=j(t.sorter);this.dupDetector=t.dupDetector||i;this.local=oParser.local(t);this.prefetch=oParser.prefetch(t);this.remote=oParser.remote(t);this.cacheKey=this.prefetch?(this.prefetch.cacheKey||this.prefetch.url):null;this.index=new SearchIndex({datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer});this.storage=this.cacheKey?new PersistentStorage(this.cacheKey):null}c.noConflict=function s(){l.Bloodhound=a;return c};c.tokenizers=tokenizers;_.mixin(c.prototype,{_loadPrefetch:function d(x){var u=this,w,t;if(w=this._readFromStorage(x.thumbprint)){this.index.bootstrap(w);t=$.Deferred().resolve()}else{t=$.ajax(x.url,x.ajax).done(v)}return t;function v(y){u.clear();u.add(x.filter?x.filter(y):y);u._saveToStorage(u.index.serialize(),x.thumbprint,x.ttl)}},_getFromRemote:function f(y,t){var x=this,v,w;if(!this.transport){return}y=y||"";w=encodeURIComponent(y);v=this.remote.replace?this.remote.replace(this.remote.url,y):this.remote.url.replace(this.remote.wildcard,w);return this.transport.get(v,this.remote.ajax,u);function u(z,A){z?t([]):t(x.remote.filter?x.remote.filter(A):A)}},_cancelLastRemoteRequest:function r(){this.transport&&this.transport.cancel()},_saveToStorage:function m(v,u,t){if(this.storage){this.storage.set(g.data,v,t);this.storage.set(g.protocol,location.protocol,t);this.storage.set(g.thumbprint,u,t)}},_readFromStorage:function q(u){var t={},v;if(this.storage){t.data=this.storage.get(g.data);t.protocol=this.storage.get(g.protocol);t.thumbprint=this.storage.get(g.thumbprint)}v=t.thumbprint!==u||t.protocol!==location.protocol;return t.data&&!v?t.data:null},_initialize:function b(){var w=this,v=this.local,t;t=this.prefetch?this._loadPrefetch(this.prefetch):$.Deferred().resolve();v&&t.done(u);this.transport=this.remote?new Transport(this.remote):null;return(this.initPromise=t.promise());function u(){w.add(_.isFunction(v)?v():v)}},initialize:function b(t){return !this.initPromise||t?this._initialize():this.initPromise},add:function h(t){this.index.add(t)},get:function o(x,t){var v=this,w=[],u=false;w=this.index.get(x);w=this.sorter(w).slice(0,this.limit);w.length<this.limit?(u=this._getFromRemote(x,y)):this._cancelLastRemoteRequest();if(!u){(w.length>0||!this.transport)&&t&&t(w)}function y(A){var z=w.slice(0);_.each(A,function(C){var B;B=_.some(z,function(D){return v.dupDetector(C,D)});!B&&z.push(C);return z.length<v.limit});t&&t(v.sorter(z))}},clear:function k(){this.index.reset()},clearPrefetchCache:function e(){this.storage&&this.storage.clear()},clearRemoteCache:function n(){this.transport&&Transport.resetCache()},ttAdapter:function p(){return _.bind(this.get,this)}});return c;function j(u){return _.isFunction(u)?t:v;function t(w){return w.sort(u)}function v(w){return w}}function i(){return false}})(this);