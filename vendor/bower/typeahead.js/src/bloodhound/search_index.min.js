var SearchIndex=(function(){function a(j){j=j||{};if(!j.datumTokenizer||!j.queryTokenizer){$.error("datumTokenizer and queryTokenizer are both required")}this.datumTokenizer=j.datumTokenizer;this.queryTokenizer=j.queryTokenizer;this.reset()}_.mixin(a.prototype,{bootstrap:function c(j){this.datums=j.datums;this.trie=j.trie},add:function(k){var j=this;k=_.isArray(k)?k:[k];_.each(k,function(l){var n,m;n=j.datums.push(l)-1;m=e(j.datumTokenizer(l));_.each(m,function(o){var r,q,p;r=j.trie;q=o.split("");while(p=q.shift()){r=r.children[p]||(r.children[p]=h());r.ids.push(n)}})})},get:function b(l){var j=this,m,k;m=e(this.queryTokenizer(l));_.each(m,function(n){var r,q,p,o;if(k&&k.length===0){return false}r=j.trie;q=n.split("");while(r&&(p=q.shift())){r=r.children[p]}if(r&&q.length===0){o=r.ids.slice(0);k=k?f(k,o):o}else{k=[];return false}});return k?_.map(d(k),function(n){return j.datums[n]}):[]},reset:function g(){this.datums=[];this.trie=h()},serialize:function i(){return{datums:this.datums,trie:this.trie}}});return a;function e(j){j=_.filter(j,function(k){return !!k});j=_.map(j,function(k){return k.toLowerCase()});return j}function h(){return{ids:[],children:{}}}function d(n){var k={},m=[];for(var l=0,j=n.length;l<j;l++){if(!k[n[l]]){k[n[l]]=true;m.push(n[l])}}return m}function f(o,m){var k=0,n=0,q=[];o=o.sort(p);m=m.sort(p);var l=o.length,j=m.length;while(k<l&&n<j){if(o[k]<m[n]){k++}else{if(o[k]>m[n]){n++}else{q.push(o[k]);k++;n++}}}return q;function p(s,r){return s-r}}})();