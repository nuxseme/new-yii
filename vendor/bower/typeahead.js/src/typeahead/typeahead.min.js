var Typeahead=(function(){var B="ttAttrs";function l(H){var G,I,F;H=H||{};if(!H.input){$.error("missing input")}this.isActivated=false;this.autoselect=!!H.autoselect;this.minLength=_.isNumber(H.minLength)?H.minLength:1;this.$node=v(H.input,H.withHint);G=this.$node.find(".tt-dropdown-menu");I=this.$node.find(".tt-input");F=this.$node.find(".tt-hint");I.on("blur.tt",function(K){var M,L,J;M=document.activeElement;L=G.is(M);J=G.has(M).length>0;if(_.isMsie()&&(L||J)){K.preventDefault();K.stopImmediatePropagation();_.defer(function(){I.focus()})}});G.on("mousedown.tt",function(J){J.preventDefault()});this.eventBus=H.eventBus||new EventBus({el:I});this.dropdown=new Dropdown({menu:G,datasets:H.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=new Input({input:I,hint:F}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this);this._setLanguageDirection()}_.mixin(l.prototype,{_onSuggestionClicked:function c(H,G){var F;if(F=this.dropdown.getDatumForSuggestion(G)){this._select(F)}},_onCursorMoved:function w(){var F=this.dropdown.getDatumForCursor();this.input.setInputValue(F.value,true);this.eventBus.trigger("cursorchanged",F.raw,F.datasetName)},_onCursorRemoved:function f(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function r(){this._updateHint()},_onOpened:function d(){this._updateHint();this.eventBus.trigger("opened")},_onClosed:function i(){this.input.clearHint();this.eventBus.trigger("closed")},_onFocused:function t(){this.isActivated=true;this.dropdown.open()},_onBlurred:function u(){this.isActivated=false;this.dropdown.empty();this.dropdown.close()},_onEnterKeyed:function p(G,F){var H,I;H=this.dropdown.getDatumForCursor();I=this.dropdown.getDatumForTopSuggestion();if(H){this._select(H);F.preventDefault()}else{if(this.autoselect&&I){this._select(I);F.preventDefault()}}},_onTabKeyed:function E(H,G){var F;if(F=this.dropdown.getDatumForCursor()){this._select(F);G.preventDefault()}else{this._autocomplete(true)}},_onEscKeyed:function z(){this.dropdown.close();this.input.resetInputValue()},_onUpKeyed:function b(){var F=this.input.getQuery();this.dropdown.isEmpty&&F.length>=this.minLength?this.dropdown.update(F):this.dropdown.moveCursorUp();this.dropdown.open()},_onDownKeyed:function g(){var F=this.input.getQuery();this.dropdown.isEmpty&&F.length>=this.minLength?this.dropdown.update(F):this.dropdown.moveCursorDown();this.dropdown.open()},_onLeftKeyed:function D(){this.dir==="rtl"&&this._autocomplete()},_onRightKeyed:function q(){this.dir==="ltr"&&this._autocomplete()},_onQueryChanged:function n(G,F){this.input.clearHintIfInvalid();F.length>=this.minLength?this.dropdown.update(F):this.dropdown.empty();this.dropdown.open();this._setLanguageDirection()},_onWhitespaceChanged:function A(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function y(){var F;if(this.dir!==(F=this.input.getLanguageDirection())){this.dir=F;this.$node.css("direction",F);this.dropdown.setLanguageDirection(F)}},_updateHint:function s(){var G,K,J,I,F,H;G=this.dropdown.getDatumForTopSuggestion();if(G&&this.dropdown.isVisible()&&!this.input.hasOverflow()){K=this.input.getInputValue();J=Input.normalizeQuery(K);I=_.escapeRegExChars(J);F=new RegExp("^(?:"+I+")(.+$)","i");H=F.exec(G.value);H?this.input.setHint(K+H[1]):this.input.clearHint()}else{this.input.clearHint()}},_autocomplete:function C(H){var J,I,F,G;J=this.input.getHint();I=this.input.getQuery();F=H||this.input.isCursorAtEnd();if(J&&I!==J&&F){G=this.dropdown.getDatumForTopSuggestion();G&&this.input.setInputValue(G.value);this.eventBus.trigger("autocompleted",G.raw,G.datasetName)}},_select:function o(F){this.input.setQuery(F.value);this.input.setInputValue(F.value,true);this._setLanguageDirection();this.eventBus.trigger("selected",F.raw,F.datasetName);this.dropdown.close();_.defer(_.bind(this.dropdown.empty,this.dropdown))},open:function k(){this.dropdown.open()},close:function m(){this.dropdown.close()},setVal:function a(F){F=_.toStr(F);if(this.isActivated){this.input.setInputValue(F)}else{this.input.setQuery(F);this.input.setInputValue(F,true)}this._setLanguageDirection()},getVal:function j(){return this.input.getQuery()},destroy:function x(){this.input.destroy();this.dropdown.destroy();e(this.$node);this.$node=null}});return l;function v(F,K){var L,H,J,G;L=$(F);H=$(html.wrapper).css(css.wrapper);J=$(html.dropdown).css(css.dropdown);G=L.clone().css(css.hint).css(h(L));G.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",true).attr({autocomplete:"off",spellcheck:"false",tabindex:-1});L.data(B,{dir:L.attr("dir"),autocomplete:L.attr("autocomplete"),spellcheck:L.attr("spellcheck"),style:L.attr("style")});L.addClass("tt-input").attr({autocomplete:"off",spellcheck:false}).css(K?css.input:css.inputWithNoHint);try{!L.attr("dir")&&L.attr("dir","auto")}catch(I){}return L.wrap(H).parent().prepend(K?G:null).append(J)}function h(F){return{backgroundAttachment:F.css("background-attachment"),backgroundClip:F.css("background-clip"),backgroundColor:F.css("background-color"),backgroundImage:F.css("background-image"),backgroundOrigin:F.css("background-origin"),backgroundPosition:F.css("background-position"),backgroundRepeat:F.css("background-repeat"),backgroundSize:F.css("background-size")}}function e(F){var G=F.find(".tt-input");_.each(G.data(B),function(I,H){_.isUndefined(I)?G.removeAttr(H):G.attr(H,I)});G.detach().removeData(B).removeClass("tt-input").insertAfter(F);F.remove()}})();