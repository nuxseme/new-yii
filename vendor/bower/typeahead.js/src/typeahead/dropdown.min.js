var Dropdown=(function(){function t(C){var A=this,y,B,z;C=C||{};if(!C.menu){$.error("menu is required")}this.isOpen=false;this.isEmpty=true;this.datasets=_.map(C.datasets,k);y=_.bind(this._onSuggestionClick,this);B=_.bind(this._onSuggestionMouseEnter,this);z=_.bind(this._onSuggestionMouseLeave,this);this.$menu=$(C.menu).on("click.tt",".tt-suggestion",y).on("mouseenter.tt",".tt-suggestion",B).on("mouseleave.tt",".tt-suggestion",z);_.each(this.datasets,function(D){A.$menu.append(D.getRoot());D.onSync("rendered",A._onRendered,A)})}_.mixin(t.prototype,EventEmitter,{_onSuggestionClick:function s(y){this.trigger("suggestionClicked",$(y.currentTarget))},_onSuggestionMouseEnter:function a(y){this._removeCursor();this._setCursor($(y.currentTarget),true)},_onSuggestionMouseLeave:function n(){this._removeCursor()},_onRendered:function g(){this.isEmpty=_.every(this.datasets,y);this.isEmpty?this._hide():(this.isOpen&&this._show());this.trigger("datasetRendered");function y(z){return z.isEmpty()}},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function f(){return this.$menu.find(".tt-suggestion")},_getCursor:function d(){return this.$menu.find(".tt-cursor").first()},_setCursor:function v(z,y){z.first().addClass("tt-cursor");!y&&this.trigger("cursorMoved")},_removeCursor:function c(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function b(y){var A,z,C,B;if(!this.isOpen){return}z=this._getCursor();A=this._getSuggestions();this._removeCursor();C=A.index(z)+y;C=(C+1)%(A.length+1)-1;if(C===-1){this.trigger("cursorRemoved");return}else{if(C<-1){C=A.length-1}}this._setCursor(B=A.eq(C));this._ensureVisible(B)},_ensureVisible:function r(B){var y,A,z,C;y=B.position().top;A=y+B.outerHeight(true);z=this.$menu.scrollTop();C=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);if(y<0){this.$menu.scrollTop(z+y)}else{if(C<A){this.$menu.scrollTop(z+(A-C))}}},close:function o(){if(this.isOpen){this.isOpen=false;this._removeCursor();this._hide();this.trigger("closed")}},open:function m(){if(!this.isOpen){this.isOpen=true;!this.isEmpty&&this._show();this.trigger("opened")}},setLanguageDirection:function w(y){this.$menu.css(y==="ltr"?css.ltr:css.rtl)},moveCursorUp:function h(){this._moveCursor(-1)},moveCursorDown:function x(){this._moveCursor(+1)},getDatumForSuggestion:function j(z){var y=null;if(z.length){y={raw:Dataset.extractDatum(z),value:Dataset.extractValue(z),datasetName:Dataset.extractDatasetName(z)}}return y},getDatumForCursor:function e(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function q(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function i(y){_.each(this.datasets,z);function z(A){A.update(y)}},empty:function l(){_.each(this.datasets,y);this.isEmpty=true;function y(z){z.clear()}},isVisible:function p(){return this.isOpen&&!this.isEmpty},destroy:function u(){this.$menu.off(".tt");this.$menu=null;_.each(this.datasets,y);function y(z){z.destroy()}}});return t;function k(y){return new Dataset(y)}})();