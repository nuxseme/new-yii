var Dataset=(function(){var b="ttDataset",p="ttValue",j="ttDatum";function a(q){q=q||{};q.templates=q.templates||{};if(!q.source){$.error("missing source")}if(q.name&&!d(q.name)){$.error("invalid dataset name: "+q.name)}this.query=null;this.highlight=!!q.highlight;this.name=q.name||_.getUniqueId();this.source=q.source;this.displayFn=e(q.display||q.displayKey);this.templates=f(q.templates,this.displayFn);this.$el=$(html.dataset.replace("%CLASS%",this.name))}a.extractDatasetName=function n(q){return $(q).data(b)};a.extractValue=function k(q){return $(q).data(p)};a.extractDatum=function k(q){return $(q).data(j)};_.mixin(a.prototype,EventEmitter,{_render:function c(w,q){if(!this.$el){return}var v=this,s;this.$el.empty();s=q&&q.length;if(!s&&this.templates.empty){this.$el.html(r()).prepend(v.templates.header?u():null).append(v.templates.footer?t():null)}else{if(s){this.$el.html(x()).prepend(v.templates.header?u():null).append(v.templates.footer?t():null)}}this.trigger("rendered");function r(){return v.templates.empty({query:w,isEmpty:true})}function x(){var z,y;z=$(html.suggestions).css(css.suggestions);y=_.map(q,A);z.append.apply(z,y);v.highlight&&highlight({className:"tt-highlight",node:z[0],pattern:w});return z;function A(B){var C;C=$(html.suggestion).append(v.templates.suggestion(B)).data(b,v.name).data(p,v.displayFn(B)).data(j,B);C.children().each(function(){$(this).css(css.suggestionChild)});return C}}function u(){return v.templates.header({query:w,isEmpty:!s})}function t(){return v.templates.footer({query:w,isEmpty:!s})}},getRoot:function l(){return this.$el},update:function g(s){var r=this;this.query=s;this.canceled=false;this.source(s,q);function q(t){if(!r.canceled&&s===r.query){r._render(s,t)}}},cancel:function o(){this.canceled=true},clear:function i(){this.cancel();this.$el.empty();this.trigger("rendered")},isEmpty:function h(){return this.$el.is(":empty")},destroy:function m(){this.$el=null}});return a;function e(q){q=q||"value";return _.isFunction(q)?q:r;function r(s){return s[q]}}function f(r,s){return{empty:r.empty&&_.templatify(r.empty),header:r.header&&_.templatify(r.header),footer:r.footer&&_.templatify(r.footer),suggestion:r.suggestion||q};function q(t){return"<p>"+s(t)+"</p>"}}function d(q){return(/^[_a-zA-Z0-9-]+$/).test(q)}})();