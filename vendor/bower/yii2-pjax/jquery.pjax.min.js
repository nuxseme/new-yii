/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
(function(h){function m(I,J,K){var L=this;return this.on("click.pjax",I,function(N){var M=h.extend({history:true},v(J,K));if(!M.container){M.container=h(this).attr("data-pjax")||L}n(N,M)})}function n(N,J,K){K=v(J,K);var M=N.currentTarget;if(h(M).data("pjax")==0){return}if(M.tagName.toUpperCase()!=="A"){throw"$.fn.pjax or $.pjax.click requires an anchor element"}if(N.which>1||N.metaKey||N.ctrlKey||N.shiftKey||N.altKey){return}if(location.protocol!==M.protocol||location.hostname!==M.hostname){return}if(M.href.indexOf("#")>-1&&A(M)==A(location)){return}if(N.isDefaultPrevented()){return}var O={url:M.href,container:h(M).attr("data-pjax"),target:M};var L=h.extend({},O,K);var I=h.Event("pjax:click");h(M).trigger(I,[L]);if(!I.isDefaultPrevented()){D(L);N.preventDefault();h(M).trigger("pjax:clicked",[L])}}function t(L,I,J){J=v(I,J);var K=L.currentTarget;if(K.tagName.toUpperCase()!=="FORM"){throw"$.pjax.submit requires a form element"}var M={type:K.method.toUpperCase(),url:K.action,container:h(K).attr("data-pjax"),target:K};if(M.type!=="GET"&&window.FormData!==undefined){M.data=new FormData(K);M.processData=false;M.contentType=false}else{if(h(K).find(":file").length){return}M.data=h(K).serializeArray()}D(h.extend({},M,J));L.preventDefault()}function D(I){I=h.extend(true,{},h.ajaxSettings,D.defaults,I);if(h.isFunction(I.url)){I.url=I.url()}var N=I.target;var M=r(I.url).hash;var J=I.context=u(I.container);if(!I.data){I.data={}}if(h.isArray(I.data)){I.data.push({name:"_pjax",value:J.selector})}else{I.data._pjax=J.selector}function L(R,P,Q){if(!Q){Q={}}Q.relatedTarget=N;var S=h.Event(R,Q);J.trigger(S,P);return !S.isDefaultPrevented()}var K;I.beforeSend=function(R,Q){if(Q.type!=="GET"){Q.timeout=0}R.setRequestHeader("X-PJAX","true");R.setRequestHeader("X-PJAX-Container",J.selector);if(!L("pjax:beforeSend",[R,Q])){return false}if(Q.timeout>0){K=setTimeout(function(){if(L("pjax:timeout",[R,I])){R.abort("timeout")}},Q.timeout);Q.timeout=0}var P=r(Q.url);P.hash=M;I.requestUrl=s(P.href)};I.complete=function(P,Q){if(K){clearTimeout(K)}L("pjax:complete",[P,Q,I]);L("pjax:end",[P,I])};I.error=function(S,U,Q){var P=z("",S,I);var T=(S.status>=301&&S.status<=303);var R=T||L("pjax:error",[S,U,Q,I]);if(T||I.type=="GET"&&U!=="abort"&&R){if(I.replaceRedirect){B(P.url)}else{if(I.pushRedirect){window.history.pushState(null,"",P.url);window.location.replace(P.url)}}}};I.success=function(T,S,aa){var W=D.state;var Z=(typeof h.pjax.defaults.version==="function")?h.pjax.defaults.version():h.pjax.defaults.version;var ab=aa.getResponseHeader("X-PJAX-Version");var R=z(T,aa,I);var Q=r(R.url);if(M){Q.hash=M;R.url=Q.href}if(Z&&ab&&Z!==ab){B(R.url);return}if(!R.contents){B(R.url);return}D.state={id:I.id||o(),url:R.url,title:R.title,container:J.selector,fragment:I.fragment,timeout:I.timeout};if(I.history&&(I.push||I.replace)){window.history.replaceState(D.state,R.title,R.url)}try{document.activeElement.blur()}catch(Y){}if(R.title){document.title=R.title}L("pjax:beforeReplace",[R.contents,I],{state:D.state,previousState:W});J.html(R.contents);var V=J.find("input[autofocus], textarea[autofocus]").last()[0];if(V&&document.activeElement!==V){V.focus()}a(R.scripts);var U=I.scrollTo;if(M){var P=decodeURIComponent(M.slice(1));var X=document.getElementById(P)||document.getElementsByName(P)[0];if(X){U=h(X).offset().top}}if(typeof U=="number"){h(window).scrollTop(U)}L("pjax:success",[T,S,aa,I])};if(!D.state){D.state={id:o(),url:window.location.href,title:document.title,container:J.selector,fragment:I.fragment,timeout:I.timeout};window.history.replaceState(D.state,document.title)}G(D.xhr);I.url=s(I.url);D.options=I;var O=D.xhr=h.ajax(I);if(O.readyState>0){if(I.history&&(I.push&&!I.replace)){k(D.state.id,E(J));window.history.pushState(null,"",I.requestUrl)}L("pjax:start",[O,I]);L("pjax:send",[O,I])}return D.xhr}function y(I,J){var K={url:window.location.href,push:false,replace:true,scrollTo:false};return D(h.extend(K,v(I,J)))}function B(I){if(!D.options.history){return}window.history.replaceState(null,"",D.state.url);window.location.replace(I)}var j=true;var H=window.location.href;var F=window.history.state;if(F&&F.container){D.state=F}if("state" in window.history){j=false}function c(J){if(!j){G(D.xhr)}var P=D.state;var I=J.state;if(I&&I.container){if(j&&H==I.url){return}var Q,O=I.container;if(P){if(P.id===I.id){return}Q=P.id<I.id?"forward":"back";if(Q=="back"){O=P.container}}var K=h(O);if(K.length){var M=f[I.id];if(P){w(Q,P.id,E(K))}var N=h.Event("pjax:popstate",{state:I,direction:Q});K.trigger(N);var R={id:I.id,url:I.url,container:K,push:false,fragment:I.fragment,timeout:I.timeout,scrollTo:false};if(M){K.trigger("pjax:start",[null,R]);D.state=I;if(I.title){document.title=I.title}var L=h.Event("pjax:beforeReplace",{state:I,previousState:P});K.trigger(L,[M,R]);K.html(M);K.trigger("pjax:end",[null,R])}else{D(R)}K[0].offsetHeight}else{B(location.href)}}j=false}function e(J){var I=h.isFunction(J.url)?J.url():J.url,N=J.type?J.type.toUpperCase():"GET";var L=h("<form>",{method:N==="GET"?"GET":"POST",action:I,style:"display:none"});if(N!=="GET"&&N!=="POST"){L.append(h("<input>",{type:"hidden",name:"_method",value:N.toLowerCase()}))}var M=J.data;if(typeof M==="string"){h.each(M.split("&"),function(O,P){var Q=P.split("=");L.append(h("<input>",{type:"hidden",name:Q[0],value:Q[1]}))})}else{if(h.isArray(M)){h.each(M,function(O,P){L.append(h("<input>",{type:"hidden",name:P.name,value:P.value}))})}else{if(typeof M==="object"){var K;for(K in M){L.append(h("<input>",{type:"hidden",name:K,value:M[K]}))}}}}h(document.body).append(L);L.submit()}function G(I){if(I&&I.readyState<4){I.onreadystatechange=h.noop;I.abort()}}function o(){return(new Date).getTime()}function E(J){var I=J.clone();I.find("script").each(function(){if(!this.src){jQuery._data(this,"globalEval",false)}});return I.contents()}function l(J,I){return J.replace(new RegExp("[?&]"+I+"=[^&#]*"),"").replace(/[?&]($|#)/,"\1").replace(/[?&]/,"?")}function s(I){I=l(I,"_pjax");I=l(I,"_");return I}function r(J){var I=document.createElement("a");I.href=J;return I}function A(I){return I.href.replace(/#.*/,"")}function v(I,J){if(I&&J){J.container=I}else{if(h.isPlainObject(I)){J=I}else{J={container:I}}}if(J.container){J.container=u(J.container)}return J}function u(I){I=h(I);if(!I.length){throw"no pjax container for "+I.selector}else{if(I.selector!==""&&I.context===document){return I}else{if(I.attr("id")){return h("#"+I.attr("id"))}else{throw"cant get selector for pjax container!"}}}}function p(J,I){return J.filter(I).add(J.find(I))}function x(I){return h.parseHTML(I,document,true)}function z(M,O,Q){var L={},I=/<html/i.test(M);var J=O.getResponseHeader("X-PJAX-URL");L.url=J?s(J):Q.requestUrl;if(I){var N=h(x(M.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0]));var K=h(x(M.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))}else{var N=K=h(x(M))}if(K.length===0){return L}L.title=p(N,"title").last().text();if(Q.fragment){if(Q.fragment==="body"){var P=K}else{var P=p(K,Q.fragment).first()}if(P.length){L.contents=Q.fragment==="body"?P:P.contents();if(!L.title){L.title=P.attr("title")||P.data("title")}}}else{if(!I){L.contents=K}}if(L.contents){L.contents=L.contents.not(function(){return h(this).is("title")});L.contents.find("title").remove();L.scripts=p(L.contents,"script[src]").remove();L.contents=L.contents.not(L.scripts)}if(L.title){L.title=h.trim(L.title)}return L}function a(I){if(!I){return}var J=h("script[src]");I.each(function(){var M=this.src;var N=J.filter(function(){return this.src===M});if(N.length){return}var K=document.createElement("script");var L=h(this).attr("type");if(L){K.type=L}K.src=h(this).attr("src");document.head.appendChild(K)})}var f={};var g=[];var i=[];function k(J,I){if(!D.options.cache){return}f[J]=I;i.push(J);b(g,0);b(i,D.defaults.maxCacheLength)}function w(K,M,J){if(!D.options.cache){return}var L,I;f[M]=J;if(K==="forward"){L=i;I=g}else{L=g;I=i}L.push(M);if(M=I.pop()){delete f[M]}b(L,D.defaults.maxCacheLength)}function b(I,J){while(I.length>J){delete f[I.shift()]}}function C(){return h("meta").filter(function(){var I=h(this).attr("http-equiv");return I&&I.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function q(){h.fn.pjax=m;h.pjax=D;h.pjax.enable=h.noop;h.pjax.disable=d;h.pjax.click=n;h.pjax.submit=t;h.pjax.reload=y;h.pjax.defaults={history:true,cache:true,timeout:650,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:C,pushRedirect:false,replaceRedirect:true};h(window).on("popstate.pjax",c)}function d(){h.fn.pjax=function(){return this};h.pjax=e;h.pjax.enable=q;h.pjax.disable=h.noop;h.pjax.click=h.noop;h.pjax.submit=h.noop;h.pjax.reload=function(){window.location.reload()};h(window).off("popstate.pjax",c)}if(h.inArray("state",h.event.props)<0){h.event.props.push("state")}h.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);h.support.pjax?q():d()})(jQuery);